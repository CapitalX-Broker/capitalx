<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CapitalX ‚Äî SA Broker Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #C9A84C;
    --gold-light: #E8C97A;
    --gold-dark: #9A7A2E;
    --black: #0A0A0A;
    --dark: #111318;
    --card: #161A22;
    --card2: #1C2130;
    --border: #252B3A;
    --text: #E8EAF0;
    --muted: #6B7280;
    --green: #22C55E;
    --red: #EF4444;
    --blue: #3B82F6;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--black); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; }
  h1,h2,h3,h4 { font-family:'Syne',sans-serif; }

  /* ===== LOGIN ===== */
  #login-screen {
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(ellipse at 30% 20%, #1a1400 0%, var(--black) 60%);
    position:relative; overflow:hidden;
  }
  #login-screen::before {
    content:''; position:absolute; inset:0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23C9A84C' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }
  .login-box {
    background:var(--card); border:1px solid var(--border); border-radius:20px;
    padding:48px 40px; width:100%; max-width:420px; position:relative; z-index:1;
    box-shadow: 0 40px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(201,168,76,0.1);
  }
  .login-logo { text-align:center; margin-bottom:36px; }
  .login-logo h1 { font-size:2rem; color:var(--gold); letter-spacing:2px; }
  .login-logo p { color:var(--muted); font-size:0.85rem; margin-top:4px; }
  .login-tabs { display:flex; gap:8px; margin-bottom:28px; }
  .login-tab {
    flex:1; padding:10px; border-radius:10px; border:1px solid var(--border);
    background:transparent; color:var(--muted); font-family:'DM Sans',sans-serif;
    font-size:0.9rem; cursor:pointer; transition:all 0.2s;
  }
  .login-tab.active { background:var(--gold); color:var(--black); border-color:var(--gold); font-weight:600; }
  .form-group { margin-bottom:18px; }
  .form-group label { display:block; color:var(--muted); font-size:0.8rem; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px; }
  .form-group input {
    width:100%; padding:14px 16px; background:var(--dark); border:1px solid var(--border);
    border-radius:10px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.95rem;
    outline:none; transition:border-color 0.2s;
  }
  .form-group input:focus { border-color:var(--gold); }
  .btn-primary {
    width:100%; padding:14px; background:var(--gold); color:var(--black);
    border:none; border-radius:10px; font-family:'Syne',sans-serif; font-size:1rem;
    font-weight:700; cursor:pointer; transition:all 0.2s; margin-top:8px;
    letter-spacing:1px;
  }
  .btn-primary:hover { background:var(--gold-light); transform:translateY(-1px); }
  .login-error { color:var(--red); font-size:0.85rem; text-align:center; margin-top:12px; display:none; }
  .fsca-badge { text-align:center; margin-top:20px; color:var(--muted); font-size:0.75rem; }

  /* ===== LAYOUT ===== */
  #app { display:none; }
  .sidebar {
    position:fixed; left:0; top:0; bottom:0; width:240px;
    background:var(--dark); border-right:1px solid var(--border);
    display:flex; flex-direction:column; z-index:100;
  }
  .sidebar-logo { padding:24px 20px; border-bottom:1px solid var(--border); }
  .sidebar-logo h2 { font-family:'Syne',sans-serif; color:var(--gold); font-size:1.3rem; letter-spacing:2px; }
  .sidebar-logo p { color:var(--muted); font-size:0.72rem; margin-top:2px; }
  .sidebar-user { padding:16px 20px; border-bottom:1px solid var(--border); }
  .sidebar-user .user-name { font-weight:600; font-size:0.9rem; }
  .sidebar-user .user-role { color:var(--gold); font-size:0.75rem; margin-top:2px; }
  .sidebar-nav { flex:1; padding:16px 12px; overflow-y:auto; }
  .nav-section { color:var(--muted); font-size:0.7rem; text-transform:uppercase; letter-spacing:1.5px; padding:8px 8px 4px; }
  .nav-item {
    display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px;
    color:var(--muted); cursor:pointer; transition:all 0.15s; margin-bottom:2px;
    font-size:0.88rem;
  }
  .nav-item:hover { background:var(--card); color:var(--text); }
  .nav-item.active { background:rgba(201,168,76,0.12); color:var(--gold); }
  .sidebar-logout {
    padding:16px 12px; border-top:1px solid var(--border);
  }
  .btn-logout {
    width:100%; padding:10px; background:transparent; border:1px solid var(--border);
    border-radius:8px; color:var(--muted); cursor:pointer; font-family:'DM Sans',sans-serif;
    font-size:0.85rem; transition:all 0.2s;
  }
  .btn-logout:hover { border-color:var(--red); color:var(--red); }
  .main { margin-left:240px; padding:32px; min-height:100vh; }
  .page { display:none; }
  .page.active { display:block; }
  .page-header { margin-bottom:28px; }
  .page-header h2 { font-size:1.6rem; font-weight:700; }
  .page-header p { color:var(--muted); margin-top:4px; font-size:0.9rem; }

  /* ===== CARDS ===== */
  .stats-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:16px; margin-bottom:28px; }
  .stat-card {
    background:var(--card); border:1px solid var(--border); border-radius:14px;
    padding:20px; position:relative; overflow:hidden;
  }
  .stat-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:2px;
    background:linear-gradient(90deg, var(--gold), transparent);
  }
  .stat-label { color:var(--muted); font-size:0.78rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:10px; }
  .stat-value { font-family:'Syne',sans-serif; font-size:1.8rem; font-weight:700; }
  .stat-sub { color:var(--muted); font-size:0.78rem; margin-top:4px; }
  .stat-icon { position:absolute; top:16px; right:16px; font-size:1.5rem; opacity:0.3; }

  /* ===== TABLE ===== */
  .table-card { background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden; margin-bottom:24px; }
  .table-header { padding:18px 20px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
  .table-header h3 { font-size:1rem; font-weight:600; }
  table { width:100%; border-collapse:collapse; }
  th { padding:12px 16px; text-align:left; color:var(--muted); font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid var(--border); font-weight:500; }
  td { padding:14px 16px; border-bottom:1px solid rgba(37,43,58,0.5); font-size:0.88rem; }
  tr:last-child td { border-bottom:none; }
  tr:hover td { background:rgba(255,255,255,0.02); }

  /* ===== BADGES ===== */
  .badge { padding:4px 10px; border-radius:20px; font-size:0.75rem; font-weight:500; display:inline-block; }
  .badge-green { background:rgba(34,197,94,0.15); color:var(--green); }
  .badge-red { background:rgba(239,68,68,0.15); color:var(--red); }
  .badge-gold { background:rgba(201,168,76,0.15); color:var(--gold); }
  .badge-blue { background:rgba(59,130,246,0.15); color:var(--blue); }

  /* ===== BUTTONS ===== */
  .btn { padding:8px 16px; border-radius:8px; border:none; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:0.85rem; font-weight:500; transition:all 0.15s; }
  .btn-gold { background:var(--gold); color:var(--black); }
  .btn-gold:hover { background:var(--gold-light); }
  .btn-danger { background:rgba(239,68,68,0.15); color:var(--red); border:1px solid rgba(239,68,68,0.3); }
  .btn-danger:hover { background:rgba(239,68,68,0.25); }
  .btn-success { background:rgba(34,197,94,0.15); color:var(--green); border:1px solid rgba(34,197,94,0.3); }
  .btn-success:hover { background:rgba(34,197,94,0.25); }
  .btn-outline { background:transparent; color:var(--text); border:1px solid var(--border); }
  .btn-outline:hover { border-color:var(--gold); color:var(--gold); }
  .btn-sm { padding:5px 10px; font-size:0.78rem; }

  /* ===== MODAL ===== */
  .modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1000;
    display:none; align-items:center; justify-content:center;
  }
  .modal-overlay.show { display:flex; }
  .modal { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:32px; width:90%; max-width:480px; }
  .modal h3 { font-size:1.2rem; margin-bottom:20px; }
  .modal .form-group { margin-bottom:16px; }
  .modal-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:24px; }

  /* ===== FORM ELEMENTS ===== */
  select {
    width:100%; padding:12px 16px; background:var(--dark); border:1px solid var(--border);
    border-radius:10px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.9rem;
    outline:none; cursor:pointer;
  }
  select:focus { border-color:var(--gold); }
  textarea {
    width:100%; padding:12px 16px; background:var(--dark); border:1px solid var(--border);
    border-radius:10px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.9rem;
    outline:none; resize:vertical; min-height:80px;
  }

  /* ===== LOADING ===== */
  .loading { text-align:center; padding:40px; color:var(--muted); }
  .spinner { width:32px; height:32px; border:3px solid var(--border); border-top-color:var(--gold); border-radius:50%; animation:spin 0.8s linear infinite; margin:0 auto 12px; }
  @keyframes spin { to { transform:rotate(360deg); } }

  /* ===== CLIENT DASHBOARD ===== */
  .portfolio-hero {
    background:linear-gradient(135deg, var(--card) 0%, var(--card2) 100%);
    border:1px solid var(--border); border-radius:16px; padding:32px;
    margin-bottom:24px; position:relative; overflow:hidden;
  }
  .portfolio-hero::after {
    content:''; position:absolute; right:-40px; top:-40px;
    width:200px; height:200px; background:radial-gradient(circle, rgba(201,168,76,0.08), transparent 70%);
    border-radius:50%;
  }
  .portfolio-hero .label { color:var(--muted); font-size:0.82rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
  .portfolio-hero .value { font-family:'Syne',sans-serif; font-size:3rem; font-weight:800; color:var(--gold); }
  .portfolio-hero .sub { color:var(--muted); font-size:0.85rem; margin-top:6px; }

  /* ===== TOAST ===== */
  #toast {
    position:fixed; bottom:24px; right:24px; padding:14px 20px;
    background:var(--card); border:1px solid var(--border); border-radius:10px;
    font-size:0.88rem; z-index:9999; transform:translateY(80px); opacity:0;
    transition:all 0.3s; box-shadow:0 8px 30px rgba(0,0,0,0.4);
  }
  #toast.show { transform:translateY(0); opacity:1; }
  #toast.success { border-color:var(--green); color:var(--green); }
  #toast.error { border-color:var(--red); color:var(--red); }

  /* ===== EMPTY STATE ===== */
  .empty { text-align:center; padding:40px; color:var(--muted); }
  .empty-icon { font-size:2.5rem; margin-bottom:12px; }

  /* ===== RESPONSIVE ===== */
  @media (max-width:768px) {
    .sidebar { width:200px; }
    .main { margin-left:200px; padding:16px; }
    .stats-grid { grid-template-columns:1fr 1fr; }
  }

  /* ===== SETUP SCREEN ===== */
  #setup-screen {
    min-height:100vh; display:none; align-items:center; justify-content:center;
    background:var(--black);
  }
  .setup-box {
    background:var(--card); border:1px solid var(--border); border-radius:20px;
    padding:48px 40px; width:100%; max-width:500px;
  }
  .setup-box h2 { font-size:1.5rem; color:var(--gold); margin-bottom:8px; }
  .setup-box p { color:var(--muted); font-size:0.9rem; margin-bottom:24px; }

  .two-col { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .actions-row { display:flex; gap:8px; flex-wrap:wrap; }
  
  .balance-input-row { display:flex; gap:8px; align-items:flex-end; }
  .balance-input-row .form-group { flex:1; margin-bottom:0; }
</style>
</head>
<body>

<!-- SETUP SCREEN (first time) -->
<div id="setup-screen">
  <div class="setup-box">
    <h2>‚öôÔ∏è CapitalX Setup</h2>
    <p>Enter your GitHub credentials to connect the database. This only needs to be done once.</p>
    <div class="form-group">
      <label>GitHub Token (gist scope)</label>
      <input type="password" id="setup-token" placeholder="ghp_...">
    </div>
    <div class="form-group">
      <label>GitHub Username</label>
      <input type="text" id="setup-username" placeholder="CapitalX-Broker">
    </div>
    <div class="form-group">
      <label>Admin Password (set a new one)</label>
      <input type="password" id="setup-admin-pass" placeholder="Choose a strong password">
    </div>
    <button class="btn-primary" onclick="setupPlatform()">Initialize Platform ‚Üí</button>
    <div class="login-error" id="setup-error"></div>
  </div>
</div>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <h1>CAPITAL<span style="color:#fff">X</span></h1>
      <p>SA Broker Platform ¬∑ FSCA Regulated</p>
    </div>
    <div class="login-tabs">
      <button class="login-tab active" onclick="switchLoginTab('admin')">Admin</button>
      <button class="login-tab" onclick="switchLoginTab('client')">Client</button>
    </div>
    <div class="form-group">
      <label id="login-label">Admin Password</label>
      <input type="password" id="login-pass" placeholder="Enter password" onkeydown="if(e.key==='Enter')doLogin()">
    </div>
    <div id="client-username-field" class="form-group" style="display:none;">
      <label>Client Username</label>
      <input type="text" id="login-username" placeholder="Enter your username">
    </div>
    <button class="btn-primary" onclick="doLogin()">Sign In ‚Üí</button>
    <div class="login-error" id="login-error">Invalid credentials. Please try again.</div>
    <div class="fsca-badge">üîí Secured by CapitalX ¬∑ South Africa</div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <h2>CAPITALX</h2>
      <p>SA Broker Platform</p>
    </div>
    <div class="sidebar-user">
      <div class="user-name" id="sidebar-username">Admin</div>
      <div class="user-role" id="sidebar-role">Administrator</div>
    </div>
    <div class="sidebar-nav" id="sidebar-nav"></div>
    <div class="sidebar-logout">
      <button class="btn-logout" onclick="logout()">‚Üê Sign Out</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main" id="main-content"></div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- MODALS -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-content"></div>
</div>

<script>
// ===== CONFIG =====
const GITHUB_TOKEN_KEY = 'cx_token';
const GITHUB_USER_KEY = 'cx_user';
const GIST_ID_KEY = 'cx_gist';
const SESSION_KEY = 'cx_session';

let config = { token: '', username: '', gistId: '' };
let db = { admin: { password: '' }, clients: {} };
let currentUser = null; // { type: 'admin' } or { type: 'client', id: '...' }
let loginTab = 'admin';

// ===== INIT =====
window.onload = async () => {
  config.token = localStorage.getItem(GITHUB_TOKEN_KEY) || '';
  config.username = localStorage.getItem(GITHUB_USER_KEY) || '';
  config.gistId = localStorage.getItem(GIST_ID_KEY) || '';

  // Check saved session
  const sess = sessionStorage.getItem(SESSION_KEY);
  if (sess) {
    try {
      currentUser = JSON.parse(sess);
      if (config.token) {
        await loadDB();
        showApp();
        return;
      }
    } catch(e) {}
  }

  if (!config.token) {
    showSetup();
  } else {
    await loadDB();
    showLogin();
  }
};

function showSetup() {
  document.getElementById('setup-screen').style.display = 'flex';
  document.getElementById('login-screen').style.display = 'none';
}
function showLogin() {
  document.getElementById('setup-screen').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}
function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  renderApp();
}

// ===== GITHUB GIST API =====
async function gistRequest(method, path, body) {
  const res = await fetch(`https://api.github.com${path}`, {
    method,
    headers: {
      'Authorization': `token ${config.token}`,
      'Content-Type': 'application/json',
      'Accept': 'application/vnd.github.v3+json'
    },
    body: body ? JSON.stringify(body) : undefined
  });
  if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);
  return res.json();
}

async function loadDB() {
  if (!config.gistId) return;
  try {
    const gist = await gistRequest('GET', `/gists/${config.gistId}`);
    const content = gist.files['capitalx_db.json']?.content;
    if (content) db = JSON.parse(content);
  } catch(e) {
    console.error('Failed to load DB:', e);
  }
}

async function saveDB() {
  const content = JSON.stringify(db, null, 2);
  if (config.gistId) {
    await gistRequest('PATCH', `/gists/${config.gistId}`, {
      files: { 'capitalx_db.json': { content } }
    });
  } else {
    const gist = await gistRequest('POST', '/gists', {
      description: 'CapitalX Broker Database',
      public: false,
      files: { 'capitalx_db.json': { content } }
    });
    config.gistId = gist.id;
    localStorage.setItem(GIST_ID_KEY, gist.id);
  }
}

// ===== SETUP =====
async function setupPlatform() {
  const token = document.getElementById('setup-token').value.trim();
  const username = document.getElementById('setup-username').value.trim();
  const adminPass = document.getElementById('setup-admin-pass').value;
  const errEl = document.getElementById('setup-error');

  if (!token || !username || !adminPass) {
    errEl.textContent = 'All fields are required.'; errEl.style.display='block'; return;
  }

  config.token = token;
  config.username = username;
  localStorage.setItem(GITHUB_TOKEN_KEY, token);
  localStorage.setItem(GITHUB_USER_KEY, username);

  db = { admin: { password: adminPass }, clients: {} };

  try {
    await saveDB();
    errEl.style.display = 'none';
    showLogin();
    toast('Platform initialized successfully!', 'success');
  } catch(e) {
    errEl.textContent = 'Failed to connect. Check your token and try again.';
    errEl.style.display = 'block';
  }
}

// ===== LOGIN =====
function switchLoginTab(tab) {
  loginTab = tab;
  document.querySelectorAll('.login-tab').forEach((t,i) => {
    t.classList.toggle('active', (i===0 && tab==='admin') || (i===1 && tab==='client'));
  });
  document.getElementById('client-username-field').style.display = tab==='client' ? 'block' : 'none';
  document.getElementById('login-label').textContent = tab==='admin' ? 'Admin Password' : 'Client Password';
}

async function doLogin() {
  const pass = document.getElementById('login-pass').value;
  const errEl = document.getElementById('login-error');
  errEl.style.display = 'none';

  if (loginTab === 'admin') {
    if (pass === db.admin.password) {
      currentUser = { type: 'admin' };
      sessionStorage.setItem(SESSION_KEY, JSON.stringify(currentUser));
      showApp();
    } else {
      errEl.style.display = 'block';
    }
  } else {
    const username = document.getElementById('login-username').value.trim();
    const client = Object.values(db.clients).find(c => c.username === username && c.password === pass);
    if (client) {
      currentUser = { type: 'client', id: client.id };
      sessionStorage.setItem(SESSION_KEY, JSON.stringify(currentUser));
      showApp();
    } else {
      errEl.style.display = 'block';
    }
  }
}

function logout() {
  currentUser = null;
  sessionStorage.removeItem(SESSION_KEY);
  showLogin();
}

// ===== APP RENDER =====
function renderApp() {
  if (currentUser.type === 'admin') renderAdmin();
  else renderClient();
}

// ===== ADMIN APP =====
function renderAdmin() {
  document.getElementById('sidebar-username').textContent = 'Admin';
  document.getElementById('sidebar-role').textContent = 'Administrator ¬∑ FSCA';

  document.getElementById('sidebar-nav').innerHTML = `
    <div class="nav-section">Overview</div>
    <div class="nav-item active" onclick="adminPage('dashboard')">üìä Dashboard</div>
    <div class="nav-section">Clients</div>
    <div class="nav-item" onclick="adminPage('clients')">üë• Clients</div>
    <div class="nav-item" onclick="adminPage('balances')">üí∞ Balance Control</div>
    <div class="nav-section">Finance</div>
    <div class="nav-item" onclick="adminPage('deposits')">üí≥ Deposits</div>
    <div class="nav-item" onclick="adminPage('withdrawals')">üè¶ Withdrawals</div>
    <div class="nav-section">Settings</div>
    <div class="nav-item" onclick="adminPage('announcements')">üì¢ Announcements</div>
  `;

  adminPage('dashboard');
}

let currentAdminPage = 'dashboard';
function adminPage(page) {
  currentAdminPage = page;
  document.querySelectorAll('.nav-item').forEach(n => {
    n.classList.toggle('active', n.textContent.toLowerCase().includes(page) || 
      (page==='dashboard' && n.textContent.includes('Dashboard')));
  });

  const main = document.getElementById('main-content');
  const clients = Object.values(db.clients);

  if (page === 'dashboard') {
    const totalBalance = clients.reduce((s,c) => s + (c.balance||0), 0);
    const pendingDep = clients.flatMap(c => (c.deposits||[]).filter(d => d.status==='pending')).length;
    const pendingWith = clients.flatMap(c => (c.withdrawals||[]).filter(w => w.status==='pending')).length;

    main.innerHTML = `
      <div class="page-header">
        <h2>Dashboard</h2>
        <p>CapitalX Broker ¬∑ FSCA Regulated ¬∑ South Africa</p>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total AUM</div>
          <div class="stat-value">R ${fmtNum(totalBalance)}</div>
          <div class="stat-icon">üí∞</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Active Clients</div>
          <div class="stat-value">${clients.length}</div>
          <div class="stat-icon">üë•</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pending Deposits</div>
          <div class="stat-value">${pendingDep}</div>
          <div class="stat-icon">üí≥</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pending Withdrawals</div>
          <div class="stat-value">${pendingWith}</div>
          <div class="stat-icon">üè¶</div>
        </div>
      </div>
      <div class="table-card">
        <div class="table-header"><h3>Recent Clients</h3><button class="btn btn-gold btn-sm" onclick="adminPage('clients')">View All</button></div>
        ${clients.length === 0 ? '<div class="empty"><div class="empty-icon">üë•</div>No clients yet. Add your first client.</div>' : `
        <table>
          <thead><tr><th>Name</th><th>Username</th><th>Balance</th><th>Status</th></tr></thead>
          <tbody>${clients.slice(0,5).map(c => `
            <tr>
              <td>${c.name}</td>
              <td>${c.username}</td>
              <td><strong>R ${fmtNum(c.balance||0)}</strong></td>
              <td><span class="badge badge-green">Active</span></td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'clients') {
    main.innerHTML = `
      <div class="page-header" style="display:flex;align-items:center;justify-content:space-between;">
        <div><h2>Client Management</h2><p>Add and manage client accounts</p></div>
        <button class="btn btn-gold" onclick="showAddClientModal()">+ Add Client</button>
      </div>
      <div class="table-card">
        <div class="table-header"><h3>All Clients (${clients.length})</h3></div>
        ${clients.length === 0 ? '<div class="empty"><div class="empty-icon">üë•</div>No clients yet.</div>' : `
        <table>
          <thead><tr><th>Name</th><th>Username</th><th>Email</th><th>Balance</th><th>Actions</th></tr></thead>
          <tbody>${clients.map(c => `
            <tr>
              <td><strong>${c.name}</strong></td>
              <td>${c.username}</td>
              <td>${c.email||'-'}</td>
              <td>R ${fmtNum(c.balance||0)}</td>
              <td class="actions-row">
                <button class="btn btn-outline btn-sm" onclick="showEditClientModal('${c.id}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteClient('${c.id}')">Delete</button>
              </td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'balances') {
    main.innerHTML = `
      <div class="page-header">
        <h2>Balance Control</h2>
        <p>Adjust client account balances directly</p>
      </div>
      ${clients.length === 0 ? '<div class="table-card"><div class="empty"><div class="empty-icon">üí∞</div>No clients yet.</div></div>' : `
      <div class="table-card">
        <div class="table-header"><h3>Client Balances</h3></div>
        <table>
          <thead><tr><th>Client</th><th>Current Balance</th><th>Adjust Amount (ZAR)</th><th>Action</th></tr></thead>
          <tbody>${clients.map(c => `
            <tr>
              <td><strong>${c.name}</strong><br><span style="color:var(--muted);font-size:0.78rem">${c.username}</span></td>
              <td style="font-family:'Syne',sans-serif;font-size:1.1rem;color:var(--gold)">R ${fmtNum(c.balance||0)}</td>
              <td>
                <div class="balance-input-row">
                  <div class="form-group">
                    <input type="number" id="bal-${c.id}" placeholder="e.g. 5000" style="width:150px;padding:8px 12px;background:var(--dark);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none">
                  </div>
                </div>
              </td>
              <td>
                <button class="btn btn-success btn-sm" onclick="adjustBalance('${c.id}', 'add')">+ Add</button>
                <button class="btn btn-danger btn-sm" onclick="adjustBalance('${c.id}', 'deduct')" style="margin-left:4px">- Deduct</button>
                <button class="btn btn-outline btn-sm" onclick="setBalance('${c.id}')" style="margin-left:4px">= Set</button>
              </td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>`}
    `;
  }

  else if (page === 'deposits') {
    const allDeps = clients.flatMap(c => (c.deposits||[]).map(d => ({...d, clientName: c.name, clientId: c.id})));
    allDeps.sort((a,b) => new Date(b.date) - new Date(a.date));

    main.innerHTML = `
      <div class="page-header"><h2>Deposit Approvals</h2><p>Approve or reject incoming deposits</p></div>
      <div class="table-card">
        <div class="table-header"><h3>All Deposits</h3></div>
        ${allDeps.length === 0 ? '<div class="empty"><div class="empty-icon">üí≥</div>No deposits yet.</div>' : `
        <table>
          <thead><tr><th>Client</th><th>Amount</th><th>Method</th><th>Reference</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody>${allDeps.map(d => `
            <tr>
              <td>${d.clientName}</td>
              <td><strong>R ${fmtNum(d.amount)}</strong></td>
              <td>${d.method}</td>
              <td>${d.reference||'-'}</td>
              <td>${fmtDate(d.date)}</td>
              <td><span class="badge badge-${d.status==='approved'?'green':d.status==='rejected'?'red':'gold'}">${d.status}</span></td>
              <td>
                ${d.status==='pending' ? `
                  <button class="btn btn-success btn-sm" onclick="approveDeposit('${d.clientId}','${d.id}')">‚úì Approve</button>
                  <button class="btn btn-danger btn-sm" onclick="rejectDeposit('${d.clientId}','${d.id}')" style="margin-left:4px">‚úó Reject</button>
                ` : '-'}
              </td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'withdrawals') {
    const allWiths = clients.flatMap(c => (c.withdrawals||[]).map(w => ({...w, clientName: c.name, clientId: c.id})));
    allWiths.sort((a,b) => new Date(b.date) - new Date(a.date));

    main.innerHTML = `
      <div class="page-header"><h2>Withdrawal Approvals</h2><p>Review and process withdrawal requests</p></div>
      <div class="table-card">
        <div class="table-header"><h3>All Withdrawals</h3></div>
        ${allWiths.length === 0 ? '<div class="empty"><div class="empty-icon">üè¶</div>No withdrawals yet.</div>' : `
        <table>
          <thead><tr><th>Client</th><th>Amount</th><th>Bank</th><th>Account No.</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody>${allWiths.map(w => `
            <tr>
              <td>${w.clientName}</td>
              <td><strong>R ${fmtNum(w.amount)}</strong></td>
              <td>${w.bank}</td>
              <td>${w.accountNo}</td>
              <td>${fmtDate(w.date)}</td>
              <td><span class="badge badge-${w.status==='approved'?'green':w.status==='rejected'?'red':'gold'}">${w.status}</span></td>
              <td>
                ${w.status==='pending' ? `
                  <button class="btn btn-success btn-sm" onclick="approveWithdrawal('${w.clientId}','${w.id}')">‚úì Approve</button>
                  <button class="btn btn-danger btn-sm" onclick="rejectWithdrawal('${w.clientId}','${w.id}')" style="margin-left:4px">‚úó Reject</button>
                ` : '-'}
              </td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'announcements') {
    main.innerHTML = `
      <div class="page-header"><h2>Announcements</h2><p>Send alerts to clients</p></div>
      <div class="table-card" style="padding:24px;">
        <h3 style="margin-bottom:20px">New Announcement</h3>
        <div class="form-group"><label>Title</label><input type="text" id="ann-title" placeholder="Announcement title"></div>
        <div class="form-group"><label>Message</label><textarea id="ann-msg" placeholder="Write your message..."></textarea></div>
        <button class="btn btn-gold" onclick="sendAnnouncement()">üì¢ Send Announcement</button>
      </div>
      <div class="table-card">
        <div class="table-header"><h3>Sent Announcements</h3></div>
        ${!(db.announcements?.length) ? '<div class="empty"><div class="empty-icon">üì¢</div>No announcements yet.</div>' : `
        <table>
          <thead><tr><th>Title</th><th>Message</th><th>Date</th></tr></thead>
          <tbody>${(db.announcements||[]).map(a => `
            <tr>
              <td><strong>${a.title}</strong></td>
              <td>${a.message}</td>
              <td>${fmtDate(a.date)}</td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }
}

// ===== ADMIN ACTIONS =====
function showAddClientModal() {
  document.getElementById('modal-content').innerHTML = `
    <h3>Add New Client</h3>
    <div class="two-col">
      <div class="form-group"><label>Full Name</label><input type="text" id="m-name" placeholder="John Doe"></div>
      <div class="form-group"><label>Email</label><input type="email" id="m-email" placeholder="john@email.com"></div>
    </div>
    <div class="two-col">
      <div class="form-group"><label>Username</label><input type="text" id="m-username" placeholder="johndoe"></div>
      <div class="form-group"><label>Password</label><input type="password" id="m-password" placeholder="Set password"></div>
    </div>
    <div class="form-group"><label>Initial Balance (ZAR)</label><input type="number" id="m-balance" placeholder="0" value="0"></div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-gold" onclick="addClient()">Add Client</button>
    </div>
  `;
  document.getElementById('modal-overlay').classList.add('show');
}

function showEditClientModal(id) {
  const c = db.clients[id];
  document.getElementById('modal-content').innerHTML = `
    <h3>Edit Client</h3>
    <div class="two-col">
      <div class="form-group"><label>Full Name</label><input type="text" id="m-name" value="${c.name}"></div>
      <div class="form-group"><label>Email</label><input type="email" id="m-email" value="${c.email||''}"></div>
    </div>
    <div class="two-col">
      <div class="form-group"><label>Username</label><input type="text" id="m-username" value="${c.username}"></div>
      <div class="form-group"><label>New Password (leave blank to keep)</label><input type="password" id="m-password" placeholder="New password"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-gold" onclick="editClient('${id}')">Save Changes</button>
    </div>
  `;
  document.getElementById('modal-overlay').classList.add('show');
}

async function addClient() {
  const name = document.getElementById('m-name').value.trim();
  const email = document.getElementById('m-email').value.trim();
  const username = document.getElementById('m-username').value.trim();
  const password = document.getElementById('m-password').value;
  const balance = parseFloat(document.getElementById('m-balance').value) || 0;

  if (!name || !username || !password) { toast('Name, username and password required.', 'error'); return; }
  
  // Check duplicate username
  if (Object.values(db.clients).find(c => c.username === username)) {
    toast('Username already exists.', 'error'); return;
  }

  const id = 'c_' + Date.now();
  db.clients[id] = { id, name, email, username, password, balance, deposits:[], withdrawals:[], createdAt: new Date().toISOString() };
  
  await saveDB();
  closeModal();
  toast(`Client ${name} added!`, 'success');
  adminPage('clients');
}

async function editClient(id) {
  const name = document.getElementById('m-name').value.trim();
  const email = document.getElementById('m-email').value.trim();
  const username = document.getElementById('m-username').value.trim();
  const password = document.getElementById('m-password').value;

  if (!name || !username) { toast('Name and username required.', 'error'); return; }

  db.clients[id].name = name;
  db.clients[id].email = email;
  db.clients[id].username = username;
  if (password) db.clients[id].password = password;

  await saveDB();
  closeModal();
  toast('Client updated!', 'success');
  adminPage('clients');
}

async function deleteClient(id) {
  if (!confirm(`Delete client ${db.clients[id].name}? This cannot be undone.`)) return;
  delete db.clients[id];
  await saveDB();
  toast('Client deleted.', 'success');
  adminPage('clients');
}

async function adjustBalance(id, action) {
  const input = document.getElementById(`bal-${id}`);
  const amount = parseFloat(input.value);
  if (!amount || amount <= 0) { toast('Enter a valid amount.', 'error'); return; }

  if (action === 'add') db.clients[id].balance = (db.clients[id].balance||0) + amount;
  else if (action === 'deduct') db.clients[id].balance = Math.max(0, (db.clients[id].balance||0) - amount);
  
  await saveDB();
  toast(`Balance ${action === 'add' ? 'added' : 'deducted'}: R ${fmtNum(amount)}`, 'success');
  input.value = '';
  adminPage('balances');
}

async function setBalance(id) {
  const input = document.getElementById(`bal-${id}`);
  const amount = parseFloat(input.value);
  if (isNaN(amount) || amount < 0) { toast('Enter a valid amount.', 'error'); return; }
  
  db.clients[id].balance = amount;
  await saveDB();
  toast(`Balance set to R ${fmtNum(amount)}`, 'success');
  input.value = '';
  adminPage('balances');
}

async function approveDeposit(clientId, depId) {
  const dep = db.clients[clientId].deposits.find(d => d.id === depId);
  if (!dep) return;
  dep.status = 'approved';
  db.clients[clientId].balance = (db.clients[clientId].balance||0) + dep.amount;
  await saveDB();
  toast(`Deposit approved ‚Äî R ${fmtNum(dep.amount)} added to balance`, 'success');
  adminPage('deposits');
}

async function rejectDeposit(clientId, depId) {
  const dep = db.clients[clientId].deposits.find(d => d.id === depId);
  if (!dep) return;
  dep.status = 'rejected';
  await saveDB();
  toast('Deposit rejected.', 'success');
  adminPage('deposits');
}

async function approveWithdrawal(clientId, withId) {
  const w = db.clients[clientId].withdrawals.find(x => x.id === withId);
  if (!w) return;
  if (db.clients[clientId].balance < w.amount) {
    toast('Insufficient client balance.', 'error'); return;
  }
  w.status = 'approved';
  db.clients[clientId].balance -= w.amount;
  await saveDB();
  toast(`Withdrawal approved ‚Äî R ${fmtNum(w.amount)} deducted`, 'success');
  adminPage('withdrawals');
}

async function rejectWithdrawal(clientId, withId) {
  const w = db.clients[clientId].withdrawals.find(x => x.id === withId);
  if (!w) return;
  w.status = 'rejected';
  await saveDB();
  toast('Withdrawal rejected.', 'success');
  adminPage('withdrawals');
}

async function sendAnnouncement() {
  const title = document.getElementById('ann-title').value.trim();
  const message = document.getElementById('ann-msg').value.trim();
  if (!title || !message) { toast('Title and message required.', 'error'); return; }
  
  if (!db.announcements) db.announcements = [];
  db.announcements.unshift({ id: 'a_'+Date.now(), title, message, date: new Date().toISOString() });
  await saveDB();
  toast('Announcement sent!', 'success');
  adminPage('announcements');
}

// ===== CLIENT APP =====
function renderClient() {
  const client = db.clients[currentUser.id];
  if (!client) { logout(); return; }

  document.getElementById('sidebar-username').textContent = client.name;
  document.getElementById('sidebar-role').textContent = 'Client ¬∑ ZAR Account';

  document.getElementById('sidebar-nav').innerHTML = `
    <div class="nav-section">Trading</div>
    <div class="nav-item active" onclick="clientPage('overview')">üè† Overview</div>
    <div class="nav-section">Finance</div>
    <div class="nav-item" onclick="clientPage('deposit')">üí≥ Deposit</div>
    <div class="nav-item" onclick="clientPage('withdraw')">üè¶ Withdraw</div>
    <div class="nav-section">Info</div>
    <div class="nav-item" onclick="clientPage('announcements')">üì¢ Announcements</div>
  `;

  clientPage('overview');
}

function clientPage(page) {
  document.querySelectorAll('.nav-item').forEach(n => {
    n.classList.toggle('active', n.textContent.toLowerCase().includes(page));
  });

  const client = db.clients[currentUser.id];
  const main = document.getElementById('main-content');

  if (page === 'overview') {
    const deps = (client.deposits||[]).filter(d => d.status==='approved');
    const withs = (client.withdrawals||[]).filter(w => w.status==='approved');

    main.innerHTML = `
      <div class="page-header">
        <h2>Welcome back, ${client.name.split(' ')[0]} üëã</h2>
        <p>CapitalX Trading Account ¬∑ ZAR</p>
      </div>
      <div class="portfolio-hero">
        <div class="label">Available Balance</div>
        <div class="value">R ${fmtNum(client.balance||0)}</div>
        <div class="sub">CapitalX ZAR Account</div>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Deposited</div>
          <div class="stat-value" style="font-size:1.4rem">R ${fmtNum(deps.reduce((s,d)=>s+d.amount,0))}</div>
          <div class="stat-icon">üí≥</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Withdrawn</div>
          <div class="stat-value" style="font-size:1.4rem">R ${fmtNum(withs.reduce((s,w)=>s+w.amount,0))}</div>
          <div class="stat-icon">üè¶</div>
        </div>
      </div>
      ${db.announcements?.length ? `
      <div class="table-card">
        <div class="table-header"><h3>üì¢ Latest Announcements</h3></div>
        ${db.announcements.slice(0,3).map(a => `
          <div style="padding:16px 20px;border-bottom:1px solid var(--border)">
            <div style="font-weight:600;margin-bottom:4px">${a.title}</div>
            <div style="color:var(--muted);font-size:0.85rem">${a.message}</div>
            <div style="color:var(--muted);font-size:0.75rem;margin-top:6px">${fmtDate(a.date)}</div>
          </div>`).join('')}
      </div>` : ''}
    `;
  }

  else if (page === 'deposit') {
    main.innerHTML = `
      <div class="page-header"><h2>Deposit Funds</h2><p>Add funds to your CapitalX account</p></div>
      <div class="table-card" style="padding:28px;max-width:500px;">
        <h3 style="margin-bottom:20px">Deposit Request</h3>
        <div class="form-group"><label>Amount (ZAR)</label><input type="number" id="dep-amount" placeholder="Enter amount" min="100"></div>
        <div class="form-group"><label>Payment Method</label>
          <select id="dep-method">
            <option>EFT / Bank Transfer</option>
            <option>Credit / Debit Card</option>
            <option>Ozow Instant EFT</option>
            <option>Capitec Pay</option>
          </select>
        </div>
        <div class="form-group"><label>Reference Note</label><input type="text" id="dep-ref" placeholder="Optional reference"></div>
        <button class="btn btn-gold" onclick="submitDeposit()" style="width:100%">Submit Deposit Request</button>
      </div>
      <div class="table-card" style="margin-top:24px;">
        <div class="table-header"><h3>Deposit History</h3></div>
        ${!(client.deposits?.length) ? '<div class="empty"><div class="empty-icon">üí≥</div>No deposits yet.</div>' : `
        <table>
          <thead><tr><th>Date</th><th>Amount</th><th>Method</th><th>Status</th></tr></thead>
          <tbody>${[...(client.deposits||[])].reverse().map(d => `
            <tr>
              <td>${fmtDate(d.date)}</td>
              <td>R ${fmtNum(d.amount)}</td>
              <td>${d.method}</td>
              <td><span class="badge badge-${d.status==='approved'?'green':d.status==='rejected'?'red':'gold'}">${d.status}</span></td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'withdraw') {
    main.innerHTML = `
      <div class="page-header"><h2>Withdraw Funds</h2><p>Request a withdrawal to your bank account</p></div>
      <div class="table-card" style="padding:28px;max-width:500px;">
        <h3 style="margin-bottom:8px">Withdrawal Request</h3>
        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:20px">‚Ñπ Withdrawals are processed within 1‚Äì2 business days after admin approval.</p>
        <div style="background:var(--dark);border-radius:10px;padding:14px;margin-bottom:20px;display:flex;justify-content:space-between">
          <span style="color:var(--muted);font-size:0.85rem">Available Balance</span>
          <strong style="color:var(--gold)">R ${fmtNum(client.balance||0)}</strong>
        </div>
        <div class="form-group"><label>Amount (ZAR)</label><input type="number" id="with-amount" placeholder="Enter amount" max="${client.balance||0}"></div>
        <div class="form-group"><label>Bank Name</label>
          <select id="with-bank">
            <option>Absa Bank</option><option>Standard Bank</option><option>FNB</option>
            <option>Nedbank</option><option>Capitec Bank</option><option>African Bank</option>
          </select>
        </div>
        <div class="two-col">
          <div class="form-group"><label>Account Number</label><input type="text" id="with-accno" placeholder="Account number"></div>
          <div class="form-group"><label>Branch Code</label><input type="text" id="with-branch" placeholder="Branch code"></div>
        </div>
        <button class="btn btn-gold" onclick="submitWithdrawal()" style="width:100%">Submit Withdrawal Request</button>
      </div>
      <div class="table-card" style="margin-top:24px;">
        <div class="table-header"><h3>Withdrawal History</h3></div>
        ${!(client.withdrawals?.length) ? '<div class="empty"><div class="empty-icon">üè¶</div>No withdrawals yet.</div>' : `
        <table>
          <thead><tr><th>Date</th><th>Amount</th><th>Bank</th><th>Status</th></tr></thead>
          <tbody>${[...(client.withdrawals||[])].reverse().map(w => `
            <tr>
              <td>${fmtDate(w.date)}</td>
              <td>R ${fmtNum(w.amount)}</td>
              <td>${w.bank}</td>
              <td><span class="badge badge-${w.status==='approved'?'green':w.status==='rejected'?'red':'gold'}">${w.status}</span></td>
            </tr>`).join('')}
          </tbody>
        </table>`}
      </div>
    `;
  }

  else if (page === 'announcements') {
    main.innerHTML = `
      <div class="page-header"><h2>Announcements</h2><p>Messages from CapitalX</p></div>
      ${!(db.announcements?.length) ? '<div class="table-card"><div class="empty"><div class="empty-icon">üì¢</div>No announcements yet.</div></div>' : 
      (db.announcements||[]).map(a => `
        <div class="table-card" style="padding:24px;margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <h3>${a.title}</h3>
            <span style="color:var(--muted);font-size:0.75rem">${fmtDate(a.date)}</span>
          </div>
          <p style="color:var(--muted);margin-top:10px;line-height:1.6">${a.message}</p>
        </div>`).join('')}
    `;
  }
}

async function submitDeposit() {
  const amount = parseFloat(document.getElementById('dep-amount').value);
  const method = document.getElementById('dep-method').value;
  const reference = document.getElementById('dep-ref').value.trim();

  if (!amount || amount < 100) { toast('Minimum deposit is R 100.', 'error'); return; }

  const dep = { id: 'd_'+Date.now(), amount, method, reference, date: new Date().toISOString(), status: 'pending' };
  if (!db.clients[currentUser.id].deposits) db.clients[currentUser.id].deposits = [];
  db.clients[currentUser.id].deposits.push(dep);

  await saveDB();
  toast('Deposit request submitted! Awaiting admin approval.', 'success');
  clientPage('deposit');
}

async function submitWithdrawal() {
  const client = db.clients[currentUser.id];
  const amount = parseFloat(document.getElementById('with-amount').value);
  const bank = document.getElementById('with-bank').value;
  const accountNo = document.getElementById('with-accno').value.trim();
  const branchCode = document.getElementById('with-branch').value.trim();

  if (!amount || amount <= 0) { toast('Enter a valid amount.', 'error'); return; }
  if (amount > (client.balance||0)) { toast('Insufficient balance.', 'error'); return; }
  if (!accountNo) { toast('Account number required.', 'error'); return; }

  const w = { id: 'w_'+Date.now(), amount, bank, accountNo, branchCode, date: new Date().toISOString(), status: 'pending' };
  if (!db.clients[currentUser.id].withdrawals) db.clients[currentUser.id].withdrawals = [];
  db.clients[currentUser.id].withdrawals.push(w);

  await saveDB();
  toast('Withdrawal request submitted! Awaiting admin approval.', 'success');
  clientPage('withdraw');
}

// ===== UTILITIES =====
function closeModal() { document.getElementById('modal-overlay').classList.remove('show'); }
document.getElementById('modal-overlay').onclick = (e) => { if (e.target === document.getElementById('modal-overlay')) closeModal(); };

function fmtNum(n) {
  return Number(n||0).toLocaleString('en-ZA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function fmtDate(d) {
  return new Date(d).toLocaleDateString('en-ZA', { day:'2-digit', month:'short', year:'numeric' });
}

function toast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `show ${type}`;
  clearTimeout(window._toastTimer);
  window._toastTimer = setTimeout(() => { t.className = ''; }, 3500);
}
</script>
</body>
</html>
